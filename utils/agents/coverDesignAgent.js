/**\n * Cover Design Agent\n * Generates book cover design concepts and descriptions\n */\n\nimport { generateContent, streamGenerate, generateImage } from '@/api/geminiClient'\n\n/**\n * Generate cover design concept\n */\nexport async function generateCoverConcept(manuscript, onProgress) {\n  try {\n    const prompt = `أنشئ مفهوم تصميم غلاف كتاب احترافي:\n\nالكتاب:\nالعنوان: ${manuscript.title}\nالمؤلف: ${manuscript.author}\nالنوع: ${manuscript.genre}\nالملخص: ${manuscript.description || manuscript.content?.substring(0, 300) || ''}\nالجمهور المستهدف: ${manuscript.target_audience || 'عام'}\n\nأنشئ مفهوماً يتضمن:\n1. الألوان الرئيسية والثانوية\n2. نوع الخط (Typography)\n3. العناصر البصرية الرئيسية\n4. التخطيط والتكوين\n5. الصور أو الرسوم التوضيحية\n6. الملمس والتأثيرات\n7. الرسالة البصرية\n8. نصائح التنفيذ\n\nاجعل الوصف تفصيلياً وقابلاً للتطبيق.`\n\n    let fullContent = ''\n    await streamGenerate(prompt, (chunk) => {\n      fullContent += chunk\n      if (onProgress) onProgress(fullContent)\n    })\n\n    return {\n      success: true,\n      concept: parseCoverConcept(fullContent),\n      raw: fullContent\n    }\n  } catch (error) {\n    console.error('Cover concept generation error:', error)\n    throw new Error(`فشل توليد مفهوم الغلاف: ${error.message}`)\n  }\n}\n\n/**\n * Parse cover concept\n */\nfunction parseCoverConcept(text) {\n  const sections = text.split(/\\n\\d\\.\\s+/)\n  return {\n    colors: extractSection(sections[1] || ''),\n    typography: extractSection(sections[2] || ''),\n    visualElements: extractSection(sections[3] || ''),\n    layout: extractSection(sections[4] || ''),\n    imagery: extractSection(sections[5] || ''),\n    texture: extractSection(sections[6] || ''),\n    message: extractSection(sections[7] || ''),\n    implementationTips: extractSection(sections[8] || '')\n  }\n}\n\n/**\n * Extract section content\n */\nfunction extractSection(text) {\n  return text.split('\\n')[0]?.trim() || ''\n}\n\n/**\n * Generate multiple cover design variations\n */\nexport async function generateCoverVariations(manuscript, count = 3) {\n  try {\n    const variations = []\n\n    for (let i = 1; i <= count; i++) {\n      const prompt = `أنشئ مفهوم تصميم غلاف كتاب (الاختلاف ${i} من ${count}):\n\nالكتاب:\nالعنوان: ${manuscript.title}\nالمؤلف: ${manuscript.author}\nالنوع: ${manuscript.genre}\n\nأنشئ مفهوماً فريداً يختلف عن الآخرين:\n- أسلوب مختلف\n- ألوان مختلفة\n- تخطيط مختلف\n- رسالة بصرية مختلفة\n\nأعد وصفاً تفصيلياً للمفهوم.`\n\n      const concept = await generateContent(prompt)\n      variations.push({\n        id: i,\n        concept,\n        description: `الاختلاف ${i}`\n      })\n    }\n\n    return variations\n  } catch (error) {\n    console.error('Cover variations error:', error)\n    throw error\n  }\n}\n\n/**\n * Generate color palette suggestions\n */\nexport async function generateColorPalette(manuscript) {\n  try {\n    const prompt = `اقترح لوحة ألوان لغلاف كتاب:\n\nالكتاب:\nالعنوان: ${manuscript.title}\nالنوع: ${manuscript.genre}\nالملخص: ${manuscript.description || ''}\n\nاقترح:\n1. اللون الأساسي (HEX)\n2. اللون الثانوي (HEX)\n3. اللون الثالث (HEX)\n4. لون الخط الرئيسي (HEX)\n5. لون الخط الثانوي (HEX)\n6. لون الخلفية (HEX)\n7. شرح نفسي لكل لون\n8. نصائح الاستخدام\n\nصيغة الإجابة:\nاللون | HEX | الوصف | النفسية`\n\n    const palette = await generateContent(prompt)\n    return parseColorPalette(palette)\n  } catch (error) {\n    console.error('Color palette error:', error)\n    throw error\n  }\n}\n\n/**\n * Parse color palette\n */\nfunction parseColorPalette(text) {\n  const colors = []\n  const lines = text.split('\\n').filter(line => line.trim())\n\n  lines.forEach(line => {\n    const parts = line.split('|').map(p => p.trim())\n    if (parts.length >= 4) {\n      colors.push({\n        name: parts[0],\n        hex: parts[1],\n        description: parts[2],\n        psychology: parts[3]\n      })\n    }\n  })\n\n  return colors\n}\n\n/**\n * Generate typography recommendations\n */\nexport async function generateTypography(manuscript) {\n  try {\n    const prompt = `اقترح خطوط (Typography) لغلاف كتاب:\n\nالكتاب:\nالعنوان: ${manuscript.title}\nالنوع: ${manuscript.genre}\n\nاقترح:\n1. خط العنوان الرئيسي\n2. خط اسم المؤلف\n3. خط النص الثانوي\n4. خط الجسم (إن وجد)\n5. حجم الخط الموصى به لكل عنصر\n6. المسافات والتباعد\n7. الوزن والنمط (Bold, Italic, etc)\n8. نصائح الاستخدام\n\nصيغة الإجابة:\nالعنصر | اسم الخط | الحجم | الوزن | الملاحظات`\n\n    const typography = await generateContent(prompt)\n    return parseTypography(typography)\n  } catch (error) {\n    console.error('Typography error:', error)\n    throw error\n  }\n}\n\n/**\n * Parse typography\n */\nfunction parseTypography(text) {\n  const fonts = []\n  const lines = text.split('\\n').filter(line => line.trim())\n\n  lines.forEach(line => {\n    const parts = line.split('|').map(p => p.trim())\n    if (parts.length >= 5) {\n      fonts.push({\n        element: parts[0],\n        fontName: parts[1],\n        size: parts[2],\n        weight: parts[3],\n        notes: parts[4]\n      })\n    }\n  })\n\n  return fonts\n}\n\n/**\n * Generate layout suggestions\n */\nexport async function generateLayoutSuggestions(manuscript) {\n  try {\n    const prompt = `اقترح تخطيطات (Layouts) لغلاف كتاب:\n\nالكتاب:\nالعنوان: ${manuscript.title}\nالنوع: ${manuscript.genre}\n\nاقترح 3 تخطيطات مختلفة:\n1. التخطيط الأول\n   - وصف التكوين\n   - موضع العناصر\n   - المسافات\n   - الإيجابيات والسلبيات\n\n2. التخطيط الثاني\n   - وصف التكوين\n   - موضع العناصر\n   - المسافات\n   - الإيجابيات والسلبيات\n\n3. التخطيط الثالث\n   - وصف التكوين\n   - موضع العناصر\n   - المسافات\n   - الإيجابيات والسلبيات`\n\n    const layouts = await generateContent(prompt)\n    return parseLayouts(layouts)\n  } catch (error) {\n    console.error('Layout suggestions error:', error)\n    throw error\n  }\n}\n\n/**\n * Parse layouts\n */\nfunction parseLayouts(text) {\n  const sections = text.split(/\\n\\d\\.\\s+التخطيط/)\n  const layouts = []\n\n  sections.slice(1).forEach((section, index) => {\n    layouts.push({\n      id: index + 1,\n      description: section.trim()\n    })\n  })\n\n  return layouts\n}\n\n/**\n * Generate design guidelines\n */\nexport async function generateDesignGuidelines(manuscript) {\n  try {\n    const prompt = `أنشئ دليل تصميم شامل لغلاف كتاب:\n\nالكتاب:\nالعنوان: ${manuscript.title}\nالمؤلف: ${manuscript.author}\nالنوع: ${manuscript.genre}\n\nالدليل يجب أن يتضمن:\n1. معايير الحجم والأبعاد\n2. الدقة والجودة (DPI)\n3. صيغ الملفات المطلوبة\n4. هوامش الأمان\n5. معايير الطباعة\n6. معايير الويب\n7. معايير الكتب الإلكترونية\n8. قائمة التحقق النهائية\n\nاجعل الدليل تفصيلياً وعملياً.`\n\n    const guidelines = await generateContent(prompt)\n    return parseGuidelines(guidelines)\n  } catch (error) {\n    console.error('Design guidelines error:', error)\n    throw error\n  }\n}\n\n/**\n * Parse guidelines\n */\nfunction parseGuidelines(text) {\n  const sections = text.split(/\\n\\d\\.\\s+/)\n  return {\n    dimensions: sections[1]?.split('\\n')[0] || '',\n    resolution: sections[2]?.split('\\n')[0] || '',\n    fileFormats: sections[3]?.split('\\n')[0] || '',\n    safetyMargins: sections[4]?.split('\\n')[0] || '',\n    printingStandards: sections[5]?.split('\\n')[0] || '',\n    webStandards: sections[6]?.split('\\n')[0] || '',\n    ebookStandards: sections[7]?.split('\\n')[0] || '',\n    checklist: extractChecklist(sections[8] || '')\n  }\n}\n\n/**\n * Extract checklist\n */\nfunction extractChecklist(text) {\n  return text\n    .split('\\n')\n    .map(line => line.replace(/^[-•*\\[\\]]\\s*/, '').trim())\n    .filter(line => line.length > 0)\n}\n\n/**\n * Generate accessibility recommendations\n */\nexport async function generateAccessibilityRecommendations(manuscript) {\n  try {\n    const prompt = `اقترح توصيات إمكانية الوصول لغلاف كتاب:\n\nالكتاب: ${manuscript.title}\n\nاقترح:\n1. نسبة التباين اللوني\n2. حجم الخط الأدنى\n3. سهولة القراءة\n4. دعم الألوان العمياء\n5. وضوح الرسوم التوضيحية\n6. نصائح للطباعة الكبيرة\n7. نصائح للقارئات الآلية\n8. اختبارات الوصول\n\nاجعل التوصيات عملية وشاملة.`\n\n    const recommendations = await generateContent(prompt)\n    return recommendations\n  } catch (error) {\n    console.error('Accessibility recommendations error:', error)\n    throw error\n  }\n}\n
